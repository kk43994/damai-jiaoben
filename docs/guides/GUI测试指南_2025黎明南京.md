# GUI测试指南 - 2025黎明南京演唱会

## 准备工作

### 1. 确认环境
- ✅ Appium服务器已启动（端口4723）
- ✅ ADB设备已连接（127.0.0.1:58570）
- ✅ 大麦App已安装
- ✅ 坐标配置文件已创建（coordinates.json）

### 2. 当前状态
- GUI程序：已启动
- 坐标配置：已创建示例配置

## 操作步骤

### 步骤1：连接设备

1. 在GUI窗口中找到"设备连接"区域
2. 从下拉列表中选择设备，或手动输入端口：`58570`
3. 点击"连接设备"按钮
4. 等待状态显示"● 已连接"（绿色）

### 步骤2：导入坐标配置

1. 在"抢票配置"区域找到"坐标配置"部分
2. 点击"📁 导入坐标配置"按钮
3. 选择刚创建的 `coordinates.json` 文件
4. 确认显示"已加载: coordinates.json"（绿色）

**注意**：如果你有自己已测试的坐标文件，使用自己的文件会更准确！

### 步骤3：配置抢票参数

在"抢票配置"区域设置：

| 参数 | 设置值 |
|------|--------|
| 目标城市 | 南京 |
| 演出名称 | 2025黎明 |
| 搜索关键词 | 2025黎明 |
| 购票数量 | 1张 |
| 抢票模式 | 极速模式 |

### 步骤4：开始抢票

1. 点击"🎫 开始抢票"按钮
2. 观察右侧日志输出
3. 左侧会显示实时截图
4. 如需停止，点击"⏹ 停止抢票"按钮

## 预期流程

GUI将自动执行以下步骤：

1. **启动App** - 确保大麦App在前台
2. **处理弹窗** - 自动关闭任何启动弹窗
3. **确认首页** - 验证已进入大麦首页
4. **切换城市** - 切换到南京
5. **搜索演出** - 搜索"2025黎明"
6. **选择结果** - 点击第一个搜索结果
7. **进入详情** - 等待详情页加载
8. **点击购买** - 点击立即购买按钮
9. **选择场次** - 选择第一场
10. **选择票档** - 选择最低价
11. **确认订单** - 点击确认按钮

## 日志解读

### 正常日志示例
```
[STEP] ============================================================
[STEP] 开始抢票流程
[INFO] 目标: 南京 - 2025黎明
[INFO] 搜索关键词: 2025黎明
[OK]   ✓ ADB连接成功
[OK]   ✓ App启动成功
[OK]   ✓ 弹窗已关闭
[OK]   ✓ 已进入首页
```

### 错误日志
```
[ERROR] 请先连接设备!
[WARN]  抢票已被用户停止
[ERROR] 点击失败: ...
```

## 常见问题

### Q1: 点击位置不准确
**解决方案：**
1. 使用你自己测试过的坐标文件
2. 点击"编辑坐标"按钮，调整坐标值
3. 在GUI截图区域查看鼠标坐标来确定准确位置

### Q2: 流程卡住
**解决方案：**
1. 点击"停止抢票"按钮
2. 检查ADB连接是否正常
3. 重新连接设备
4. 再次尝试

### Q3: 找不到演出
**解决方案：**
1. 确认演出名称拼写正确
2. 确认城市已正确切换
3. 手动在App中搜索确认演出存在

## 使用自己的坐标文件

如果你有已测试通过的2025黎明南京坐标文件：

1. 准备你的坐标JSON文件，格式如下：
```json
{
  "base_resolution": [720, 1280],
  "coordinates": {
    "search_entry": [你的x坐标, 你的y坐标],
    "buy_button": [你的x坐标, 你的y坐标],
    ...
  }
}
```

2. 在GUI中点击"导入坐标配置"
3. 选择你的文件
4. 开始测试

## 调试技巧

### 1. 查看实时坐标
- 在截图区域移动鼠标
- 底部显示当前坐标
- 记录需要的位置

### 2. 保存截图
- 点击"📷 保存截图"按钮
- 截图会保存到 `screenshots/` 目录
- 用于后续分析和调整

### 3. 实时诊断
- 点击"🔍 实时页面诊断"按钮
- 查看当前页面状态
- 查看所有可点击元素

## 测试检查清单

测试前请确认：

- [ ] Appium服务器运行正常
- [ ] 设备已连接（adb devices 可见）
- [ ] 大麦App已登录
- [ ] 坐标配置已导入
- [ ] 演出信息已确认存在
- [ ] 已知道演出的场次和票档

## 进阶配置

### 启用OCR识别（可选）
如果需要页面验证：
1. 勾选"启用OCR识别"
2. 会自动识别页面文字
3. 但可能会变慢

### 调整更新间隔
- 滑动"更新间隔"滑块
- 推荐：0.5-1.0秒
- 太快可能影响稳定性

### 内存清理
- 默认20秒清理一次
- 长时间运行建议启用
- 防止内存占用过高

## 成功标志

看到以下任一情况表示进入购票流程：

1. 日志显示"已进入详情页"
2. 日志显示"点击购买按钮"
3. 截图显示订单确认页面
4. 出现座位选择界面

## 下一步

测试成功后：

1. **保存坐标** - 导出成功的坐标配置
2. **记录流程** - 记录成功的参数设置
3. **重复测试** - 多次测试验证稳定性
4. **优化速度** - 调整等待时间提升速度

## 技术支持

如遇问题：

1. 查看日志输出的详细错误
2. 检查 `坐标方案使用指南.md`
3. 运行 `python test_robust_coordinates.py --test` 测试坐标系统
4. 检查Appium日志输出

## 预期结果

**成功情况：**
- 自动打开App
- 自动搜索演出
- 自动进入详情页
- 自动点击购买
- 进入订单确认页面

**部分成功：**
- 完成前几步
- 在某一步停止
- 需要调整对应坐标

祝测试顺利！🎫
